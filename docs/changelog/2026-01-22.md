# 2026-01-22 Changelog

## Task A: 알림 중복 처리 (Notification Dedup)

### 문제
- NotificationJourney가 매번 같은 알림을 반복 처리
- 트위터 알림은 읽어도 사라지지 않음
- 같은 follow 알림에 반복 팔로우백 시도

### 해결
`session.py`에 `processed_notifications` 추가:

```python
processed_notifications: {
    "notif_id": {
        "type": "reply",
        "from_user_id": "123",
        "actions_taken": ["liked", "replied"],
        "processed_at": "2026-01-22 10:00:00"
    }
}
```

**추가된 메서드**:
- `mark_notification_processed(notif_id, type, from_user_id, action)`
- `is_notification_processed(notif_id)`
- `get_notification_actions(notif_id)`
- `is_user_already_followed_back(from_user_id)`

**NotificationJourney 수정**:
- `_classify_and_prioritize()`: 이미 처리된 알림 필터링
- `_process_notification()`: 처리 완료 후 기록

### 변경 파일
- `agent/memory/session.py` - processed_notifications + 메서드 추가
- `agent/platforms/twitter/modes/social/journeys/notification.py` - 필터링/기록 로직

---

## Task B: 설정 간소화 (Persona Config Cleanup)

### 배경
- `mood.yaml`: 대부분 폴백/미사용, activity_schedule만 효과 있음
- `speech_style.yaml`: pattern_registry, content_review가 죽은 코드
- `pattern_tracker.py`: 335줄 전체가 호출되지 않는 죽은 코드

### 변경

#### 1. mood.yaml 삭제
- `activity_schedule` → `activity.yaml`로 통합
- `time_keywords`, `mood_descriptions`, `mood_volatility` 삭제 (미사용 또는 다른 곳에서 로드)

#### 2. speech_style.yaml 간소화 (59줄 → 26줄)

**Before (규칙 기반)**:
```yaml
signature_phrases: [...]      # 반복 유발
sentence_patterns: [...]
pattern_registry: [...]       # 죽은 코드
content_review: [...]         # 죽은 코드
```

**After (예시 기반)**:
```yaml
personality_brief: "내성적이지만 요리 얘기엔 눈 반짝..."
tone: "친근하지만 과하지 않게..."
speech_examples:
  - "음... 그건 좀 다르게 봐야 할 것 같아요"
  - "아, 그거 저도 해봤는데 괜찮더라고요"
avoid:
  - "요리사로서 말씀드리면"
```

#### 3. 죽은 코드 삭제
- `agent/persona/pattern_tracker.py` 삭제 (335줄)
- `agent/core/base_generator.py`에서 pattern_tracker/review 관련 코드 제거

### 삭제된 파일

| 파일 | 이유 |
|-----|------|
| `personas/chef_choi/mood.yaml` | activity.yaml로 통합, 나머지 미사용 |
| `agent/persona/pattern_tracker.py` | 호출하는 곳 없음 (죽은 코드) |

### 핵심 인사이트
- **효과 있는 것**: 수면/휴식 패턴 (activity_schedule)
- **효과 없는 것**: 기분 변동, 시간대 키워드, 패턴 규칙
- **말투 다양성**: 규칙 기반보다 `recent_replies` 프롬프트 회피가 더 효과적
