# 2026-01-21 Changelog

## Social Mode V2 + Persona Config 구조 개편

### 배경
- Social 모드가 시나리오 기반 V2로 대대적 개편
- 기존: `scout_timeline → perceive(8회) → 점수 선택 → 답글`
- 변경: `SocialEngineV2.step() → Journey(notification 60%/feed 40%) → Scenario → LLM 1-2회`

### 변경된 파일 구조

```
personas/chef_choi/platforms/twitter/
├── activity.yaml          # 신규: 모드 가중치 + human-like + 스텝 간격
├── config.yaml            # 유지: 플랫폼 제약
├── behavior.yaml          # TODO: activity.yaml과 중복, 정리 필요
└── modes/
    ├── social/
    │   ├── config.yaml    # 통합: response_strategy + quip_pool + interaction_patterns + behavioral_rules
    │   └── style.yaml     # 유지: constraints, response_types
    ├── casual/
    └── series/
```

### 신규: `activity.yaml`

모드 간 전환 확률 + Human-like 타이밍 통합 설정

```yaml
mode_weights:
  social: 0.97    # 상호작용 위주
  casual: 0.02    # 독립 포스팅
  series: 0.01    # 콘텐츠 시리즈

social:
  journey_weights:
    notification: 0.60
    feed: 0.40

human_like:
  reading: { chars_per_second: 5, min: 1.0, max: 8.0 }
  thinking: { before_like: [0.5, 1.5], before_reply: [2.0, 5.0] }
  typing: { chars_per_second: 3 }
  after_action: { like: [0.5, 1.5], reply: [3.0, 8.0] }
  transitions: { scroll_to_next: [1.0, 3.0], mode_change: [5.0, 15.0] }
  burst_prevention: { max_consecutive: 3, cooldown: [30, 90] }
```

### 삭제된 파일

| 파일 | 이유 |
|-----|------|
| `step_schedule.yaml` | `activity.yaml`로 통합 |
| `social/behavior.yaml` | `social/config.yaml`로 통합 |

### 통합: `social/config.yaml`

기존 분산된 설정을 하나로 통합:
- `response_strategy` (응답 타입 확률)
- `quip_pool` (즉흥 반응)
- `interaction_patterns` (same_user, same_post 제한)
- `behavioral_rules` (피로도, 집착 주제)
- `follow_behavior` (팔로우 설정)

### 미완료 (TODO)

1. **`platforms/twitter/behavior.yaml` 정리**
   - `activity.yaml`의 `human_like`와 중복
   - `action_ratios`, `follow_behavior`도 다른 곳과 중복
   - 삭제 또는 통합 필요

2. **`identity.yaml`에 `personality.brief` 추가**
   - V2 `ReplyGenerator`가 `personality.brief` 읽음
   - 현재 기본값 "친근한 사람" 사용 중
   - 추가 권장: `brief: "내성적이지만 요리 얘기에는 눈이 반짝이는 셰프"`

---

## Social Engine V2 → 기본값 승격 (Uncommitted)

사용자가 직접 작업한 변경사항 (18 files, +415/-124 lines):

### 코어 변경

1. **main.py**
   - `step_probs(scout/mentions/post)` → `mode_weights(social/casual/series)`
   - `activity.yaml`의 `mode_weights` 사용

2. **agent/bot.py**
   - `SocialEngineV2` → `SocialEngine` (기본값으로 승격)
   - `use_social_v2` 플래그 제거
   - `run_social_step()` 메서드 추가

3. **agent/platforms/twitter/modes/social/engine.py**
   - 클래스명 `SocialEngineV2` → `SocialEngine`
   - `print()` → `logger.info()` 전환
   - 226/401/403 에러 상위 전파

### Personas 설정

1. **identity.yaml**
   - `personality.brief: "극내향적이지만 요리에 집착하는 셰프"` 추가

2. **behavior.yaml**
   - `action_ratios` 제거 (identity.yaml로 통합됨)

3. **social/config.yaml**
   - 순서 재정렬 (follow_behavior 상단 이동)

### 로깅 강화

모든 시나리오/Journey에 structured logging 추가:
- Scenario 시작/종료 로그
- Judge 결과 로그
- Action 결과 로그

---

## Task 1: 답글 말투 반복 방지 (recent_replies)

### 문제
- 답글 생성 시 같은 말투/어미 반복 (예: "~거든요" 연속)

### 해결
- `BaseScenario.get_recent_replies(limit=5)` 추가
- `ReplyGenerator.generate(recent_replies=[...])` 파라미터 추가
- 프롬프트: "최근 내 답글 - 이와 다른 말투/어미로 작성"

### 변경 파일
- `scenarios/base.py` - `get_recent_replies()` 메서드 추가
- `judgment/reply_generator.py` - `recent_replies` 파라미터 + 프롬프트 수정
- 5개 시나리오 - `get_recent_replies()` 호출 추가

### LLM 호출
- 변화 없음 (기존 2회 유지)

---

## Task 2: learning → modes/learning 이동

### 이유
- CLAUDE.md에서 "Learning Mode"로 정의
- 모든 모드가 `modes/` 하위에 위치하는 일관성

### 변경
```
agent/platforms/twitter/
├── learning/           # 삭제
└── modes/
    └── learning/       # 이동
        ├── __init__.py
        └── trend_learner.py
```

---

## 이전 세션 작업 (요약)

### Config 중복/죽은 설정 정리

1. `InteractionIntelligence` 수정 - `response_strategy`를 `social/config.yaml`에서 읽도록
2. `BaseContentGenerator` 수정 - `content_review`를 `speech_style.yaml`에서 읽도록
3. `identity.yaml`에 `action_ratios` 추가
4. `speech_style.yaml`에 `content_review` 이동

### safe-feature 스킬 생성

`~/.claude/skills/safe-feature/` - Git 브랜치 기반 안전한 개발 워크플로우
